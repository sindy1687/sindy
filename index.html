<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è‹±æ‰“å°è‹±é›„ - é¦–é </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* å…¨å±€æ¨£å¼ */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, 'Orbitron', sans-serif;
      background: url('https://th.bing.com/th/id/OIP.EXCeug5EiI00kMhj2ySQUwHaEo?r=0&w=1920&h=1200&rs=1&pid=ImgDetMain') center center fixed;
      background-size: cover;
      color: #f3f6fa;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* æ¨™é¡Œ */
    h1 {
      font-size: 2.8rem;
      color: #e6f0ff;
      text-shadow: 0 2px 12px #2e3a5e, 0 0 40px #a259ff, 0 0 60px #ff6b6b;
      margin: 5px 0 8px;
      text-align: center;
      font-weight: 800;
      letter-spacing: 3px;
      background: none;
      -webkit-background-clip: unset;
      -webkit-text-fill-color: unset;
      background-clip: unset;
      animation: titleGlow 3s ease-in-out infinite alternate;
      font-family: 'Orbitron', 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
    }

    @keyframes titleGlow {
      0% { filter: brightness(1) saturate(1); }
      100% { filter: brightness(1.2) saturate(1.3); }
    }

    .subtitle {
      font-size: 1.4rem;
      color: #a3b8ff;
      margin-bottom: 12px;
      text-shadow: 0 1px 8px #2e3a5e, 0 0 20px #a259ff;
      font-weight: 600;
      letter-spacing: 2px;
      background: none;
      -webkit-background-clip: unset;
      -webkit-text-fill-color: unset;
      background-clip: unset;
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
    }

    .description {
      font-size: 1.1rem;
      color: #b8c7e0;
      margin-bottom: 20px;
      line-height: 1.8;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      text-shadow: 0 1px 6px #2e3a5e;
      font-weight: 400;
      letter-spacing: 0.5px;
      background: none;
      -webkit-background-clip: unset;
      -webkit-text-fill-color: unset;
      background-clip: unset;
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
    }

    /* ä¸»è¦å®¹å™¨ */
    #container {
      max-width: 800px;
      width: 90%;
      margin: 4px auto 0 auto;
      padding: 12px;
      background: rgba(10, 20, 40, 0.45);
      border-radius: 20px;
      box-shadow: 0 0 32px #00ffff44, 0 0 80px #a259ff22 inset;
      border: 2px solid #00ffff;
      backdrop-filter: blur(2px);
      text-align: center;
      color: #f3f6fa;
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
    }

    /* ç©å®¶åç¨±è¼¸å…¥ */
    #playerName {
      width: 60%;
      padding: 8px 12px;
      margin: 8px 0;
      font-size: 0.95rem;
      background: rgba(10, 20, 40, 0.6);
      border: 2px solid #00ffff;
      border-radius: 10px;
      color: #fff;
      box-shadow: 0 0 20px #00ffff80, 0 0 40px #a259ff40;
      font-family: 'Roboto Mono', monospace;
      text-align: center;
      font-weight: 500;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      backdrop-filter: blur(2px);
    }

    #playerName:focus {
      outline: none;
      border-color: #ff6b6b;
      box-shadow: 0 0 30px #00ffff, 0 0 60px #ff6b6b80;
      transform: scale(1.02);
    }

    #playerName::placeholder {
      color: rgba(255, 255, 255, 0.6);
      font-style: italic;
    }

    /* é ­åƒé¸æ“‡ */
    .avatar-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 15px;
      margin: 16px 0;
      padding: 15px;
      background: rgba(10, 20, 40, 0.2);
      border-radius: 20px;
      border: 1px solid rgba(0, 255, 255, 0.3);
      backdrop-filter: blur(2px);
    }

    .avatar-option {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid #00ffff;
      transition: all 0.2s ease-out;
      box-shadow: 0 0 20px #00ffff44, 0 0 40px #a259ff22;
      background-size: cover;
      background-position: center top;
      background-repeat: no-repeat;
      position: relative;
      overflow: hidden;
      background-clip: content-box;
    }

    .avatar-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 50%;
    }

    .avatar-option:hover {
      transform: scale(1.08);
      box-shadow: 0 0 30px #00ffff, 0 0 60px #a259ff66;
      border-color: #ff6b6b;
      /* æ‡¸åœæ™‚æ”¾å¤§èƒŒæ™¯åœ–ç‰‡ä»¥æ›´å¥½åœ°é¡¯ç¤ºè‡‰éƒ¨ */
      background-size: 115% auto;
    }

    .avatar-option:hover::before {
      opacity: 1;
    }

    .avatar-option.selected {
      border-color: #ffd700;
      box-shadow: 0 0 30px #ffd700, 0 0 60px #ffd70066;
      transform: scale(1.1);
      animation: selectedPulse 2s ease-in-out infinite;
      /* é¸ä¸­æ™‚ä¹Ÿæ”¾å¤§èƒŒæ™¯åœ–ç‰‡ */
      background-size: 110% auto;
    }

    @keyframes selectedPulse {
      0%, 100% { box-shadow: 0 0 30px #ffd700, 0 0 60px #ffd70066; }
      50% { box-shadow: 0 0 40px #ffd700, 0 0 80px #ffd70099; }
    }

    /* æŒ‰éˆ•æ¨£å¼ */
    .btn {
      display: inline-block;
      padding: 12px 24px;
      margin: 8px;
      font-size: 1.1rem;
      color: #222b3a;
      background: linear-gradient(135deg, #00ffff 0%, #a259ff 50%, #ff6b6b 100%);
      border: none;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Orbitron', 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
      font-weight: 700;
      letter-spacing: 1.5px;
      box-shadow: 0 0 20px #00ffff, 0 0 40px #a259ff99, 0 8px 16px rgba(0, 0, 0, 0.3);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }

    .btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 0 30px #00ffff, 0 0 60px #a259ffcc, 0 12px 24px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #00ffff 0%, #a259ff 30%, #ff6b6b 70%, #ffd700 100%);
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:active {
      transform: translateY(-1px) scale(1.02);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* éŸ³æ•ˆæ§åˆ¶ */
    #audioControls {
      position: fixed;
      bottom: 15px;
      right: 15px;
      display: flex;
      gap: 8px;
    }

    #audioControls button {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      border: 2px solid #00ffff;
      background: rgba(10, 20, 40, 0.6);
      color: #fff;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 0 16px #00ffff;
      backdrop-filter: blur(1px);
    }

    #audioControls button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 32px #00ffff;
    }

    /* ç©å®¶åç¨±é¡¯ç¤º */
    #playerNameDisplay {
      position: fixed;
      top: 15px;
      right: 15px;
      background: rgba(10, 20, 40, 0.6);
      padding: 6px 12px;
      border-radius: 10px;
      color: #ffd700;
      font-weight: bold;
      box-shadow: 0 0 12px #ffd700, 0 0 32px #00ffff;
      border: 2px solid #00ffff;
      font-size: 1.1rem;
      backdrop-filter: blur(1px);
    }

    /* æ˜Ÿæ˜Ÿé¡¯ç¤º */
    #starsDisplay {
      position: fixed;
      top: 15px;
      left: 15px;
      background: rgba(10, 20, 40, 0.6);
      padding: 4px 8px;
      border-radius: 10px;
      color: #ffd700;
      font-weight: bold;
      box-shadow: 0 0 12px #ffd700, 0 0 32px #00ffff;
      border: 2px solid #00ffff;
      font-size: 1.1rem;
      backdrop-filter: blur(1px);
    }

    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 600px) {
      h1 {
        font-size: 1.6rem;
        margin: 3px 0 6px;
      }

      .subtitle {
        font-size: 1.2rem;
        margin-bottom: 8px;
      }

      #container {
        width: 95%;
        padding: 12px;
        margin: 2px auto 0 auto;
      }

      .btn {
        width: 100%;
        margin: 4px 0;
        padding: 10px 20px;
        font-size: 1rem;
      }

      .avatar-grid {
        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        gap: 8px;
        margin: 12px 0;
        padding: 12px;
      }

      .avatar-option {
        width: 60px;
        height: 60px;
      }

      #characterPreview {
        width: 200px;
        height: 280px;
        margin: 8px auto;
        background: rgba(10, 20, 40, 0.2);
        backdrop-filter: blur(4px);
      }

      .nav-buttons {
        gap: 8px;
        margin-top: 16px;
      }

      .nav-btn {
        padding: 8px 14px;
        font-size: 0.9rem;
        overflow: visible !important; /* ç¢ºä¿æˆå°±æŒ‰éˆ•åœ¨æ‰‹æ©Ÿç‰ˆä¹Ÿèƒ½æ­£å¸¸é¡¯ç¤ºæ³¡æ³¡ */
      }

      #characterSlogan {
        font-size: 1rem;
        margin: 8px 0;
        min-height: 1.2rem;
      }

      .main-buttons {
        margin: 12px 0;
      }
    }

    /* æ–°å¢æ¨£å¼ */
    .input-group {
      margin: 12px 0;
    }

    #characterPreview {
      width: 300px;
      height: 400px;
      margin: 12px auto;
      border-radius: 15px;
      overflow: hidden;
      background: rgba(10, 20, 40, 0.2);
      backdrop-filter: blur(1px);
    }

    #characterImage {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: transparent;
      mix-blend-mode: screen;
    }

    .nav-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-top: 20px;
    }

    .nav-btn {
      background: linear-gradient(135deg, #a259ff 0%, #ff6b6b 100%);
      color: #fff;
      border: none;
      padding: 10px 18px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      box-shadow: 0 0 16px #a259ff, 0 0 32px #ff6b6b99, 0 6px 12px rgba(0, 0, 0, 0.3);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      position: relative;
      overflow: hidden;
      transform-origin: center;
      will-change: transform;
    }

    .nav-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
      pointer-events: none; /* ç¢ºä¿ä¸æœƒå¹²æ“¾æ»‘é¼ äº‹ä»¶ */
    }

    .nav-btn:hover {
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 0 24px #a259ff, 0 0 48px #ff6b6bcc, 0 8px 16px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #a259ff 0%, #ff6b6b 50%, #ffd700 100%);
    }

    .nav-btn:hover::before {
      left: 100%;
    }

    .nav-btn.primary {
      background: linear-gradient(135deg, #00ffff 0%, #a259ff 100%);
      color: #000;
      font-weight: 700;
      box-shadow: 0 0 20px #00ffff, 0 0 40px #a259ff99, 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .nav-btn.primary:hover {
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 0 30px #00ffff, 0 0 60px #a259ffcc, 0 12px 24px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #00ffff 0%, #a259ff 50%, #ff6b6b 100%);
    }

    /* ä¸»æŒ‰éˆ•å€åŸŸ */
    .main-buttons {
      margin: 16px 0;
    }

    /* è§’è‰²æ¨™èª */
    #characterSlogan {
      font-size: 1.2rem;
      color: #ffe9a3;
      margin: 10px 0;
      text-shadow: 0 1px 8px #2e3a5e, 0 0 12px #ffd700;
      font-weight: 600;
      letter-spacing: 1px;
      min-height: 1.5rem;
      font-style: italic;
      transition: all 0.2s ease-out;
      opacity: 1;
      transform: translateY(0);
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
    }

    /* ä¸»è¦å…§å®¹å­—é«” */
    #container, #container * {
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
      color: #f3f6fa;
    }

    /* æŒ‰éˆ•å­—é«”é¡è‰²å¾®èª¿ */
    .btn, .nav-btn {
      color: #222b3a;
      font-family: 'Orbitron', 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
    }

    /* æ–°å¢ï¼šæˆå°±æ•¸é‡æ³¡æ³¡æ¨£å¼ */
    .achievement-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: linear-gradient(135deg, #ff6b6b, #ff4757);
      color: white;
      border-radius: 50%;
      min-width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      box-shadow: 0 0 10px rgba(255, 107, 107, 0.6);
      border: 2px solid white;
      animation: badgePulse 2s ease-in-out infinite;
      z-index: 1000;
      pointer-events: none;
      transform-origin: center;
      will-change: transform;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    @keyframes badgePulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 10px rgba(255, 107, 107, 0.6);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 0 15px rgba(255, 107, 107, 0.8);
      }
    }
    
    .achievement-badge.hidden {
      display: none;
    }

    /* æˆå°±æŒ‰éˆ•ç‰¹æ®Šè™•ç†ï¼šé¿å…hoveræ™‚æ³¡æ³¡ä½ç½®éŒ¯äº‚ */
    .nav-btn#achievementBtn {
      overflow: visible !important;
      position: relative;
      isolation: isolate; /* å‰µå»ºæ–°çš„å±¤ç–Šä¸Šä¸‹æ–‡ */
    }

    /* æˆå°±æŒ‰éˆ•hoveræ™‚ï¼Œä¿æŒæ³¡æ³¡çš„ç›¸å°ä½ç½® */
    .nav-btn#achievementBtn:hover .achievement-badge {
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(255, 107, 107, 0.8);
      animation: none; /* æš«åœåŸæœ¬çš„å‹•ç•« */
    }

    /* æˆå°±æŒ‰éˆ•hoverçµæŸå¾Œï¼Œæ¢å¾©æ³¡æ³¡å‹•ç•« */
    .nav-btn#achievementBtn:not(:hover) .achievement-badge {
      animation: badgePulse 2s ease-in-out infinite;
    }

    /* å„ªåŒ–hoverå‹•ç•«ï¼Œé¿å…èˆ‡æ³¡æ³¡è¡çª */
    .nav-btn:hover {
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 0 24px #a259ff, 0 0 48px #ff6b6bcc, 0 8px 16px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #a259ff 0%, #ff6b6b 50%, #ffd700 100%);
      z-index: 10; /* ç¢ºä¿hoveræ™‚åœ¨æœ€ä¸Šå±¤ */
    }

    /* ç¢ºä¿æ‰€æœ‰æŒ‰éˆ•å‹•ç•«éƒ½ä½¿ç”¨GPUåŠ é€Ÿ */
    .nav-btn, .btn {
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      -moz-backface-visibility: hidden;
    }

    /* å„ªåŒ–å‹•ç•«æ€§èƒ½ */
    .nav-btn:hover, .btn:hover {
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      -moz-backface-visibility: hidden;
    }
  </style>
</head>
<body>
  <!-- æ˜Ÿæ˜Ÿé¡¯ç¤º -->
  <div id="starsDisplay">
    â­<span id="totalStarsCount">0</span>
  </div>

  <!-- ä¸»å€åŸŸ -->
  <div id="container">
    <h1>ğŸŒŒ æ˜Ÿéš›è‹±æ‰“å†’éšª</h1>
    <p class="subtitle">é–‹å§‹ä½ çš„æ‰“å­—è‹±é›„ä¹‹æ—…ï¼</p>

    <!-- ä½¿ç”¨è€…åç¨±è¼¸å…¥ -->
    <div class="input-group">
      <input type="text" id="playerName" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—" maxlength="10">
    </div>

    <!-- è§’è‰²é è¦½ -->
    <div id="characterPreview">
      <img id="characterImage" src="img/avatars/avatar_astro1.png" alt="è§’è‰²é è¦½">
    </div>

    <!-- è§’è‰²æ¨™èª -->
    <div id="characterSlogan" style="
      font-size: 1.2rem;
      color: #ffd700;
      margin: 10px 0;
      text-shadow: 0 0 12px #ffd700, 0 0 24px #ff6b6b;
      font-weight: 600;
      letter-spacing: 1px;
      min-height: 1.5rem;
      font-style: italic;
      transition: all 0.2s ease-out;
      opacity: 1;
      transform: translateY(0);
    ">ğŸŒŸ å‹‡æ•¢çš„æ˜Ÿéš›æˆ°å£«ï¼Œæº–å‚™å¥½è¿æ¥æŒ‘æˆ°äº†å—ï¼Ÿ</div>

    <!-- é ­åƒé¸æ“‡ -->
    <div class="avatar-grid">
      <div class="avatar-option selected" style="background-image: url('img/avatars/avatar_TL.png');" onclick="selectAvatar(this, 'img/avatars/avatar_TL.png', 'ğŸŒŸ å‹‡æ•¢çš„æ˜Ÿéš›æˆ°å£«ï¼Œæº–å‚™å¥½è¿æ¥æŒ‘æˆ°äº†å—ï¼Ÿ', {rate: 0.9, pitch: 1.0, volume: 0.9, characterType: 'warrior'})"></div>
      <div class="avatar-option" style="background-image: url('img/avatars/avatar_TR.png');" onclick="selectAvatar(this, 'img/avatars/avatar_TR.png', 'âš¡ é–ƒé›»èˆ¬çš„é€Ÿåº¦ï¼Œç„¡äººèƒ½æ•µï¼', {rate: 1.1, pitch: 1.2, volume: 0.9, characterType: 'speedster'})"></div>
      <div class="avatar-option" style="background-image: url('img/avatars/avatar_BL.png');" onclick="selectAvatar(this, 'img/avatars/avatar_BL.png', 'ğŸ›¡ï¸ å …ä¸å¯æ‘§çš„é˜²ç¦¦ï¼Œå®ˆè­·ä½ çš„å¤¢æƒ³ï¼', {rate: 0.8, pitch: 0.9, volume: 0.95, characterType: 'defender'})"></div>
      <div class="avatar-option" style="background-image: url('img/avatars/avatar_BR.png');" onclick="selectAvatar(this, 'img/avatars/avatar_BR.png', 'ğŸ¯ ç²¾æº–çš„ç„æº–ï¼Œç™¾ç™¼ç™¾ä¸­ï¼', {rate: 0.95, pitch: 1.1, volume: 0.9, characterType: 'sharpshooter'})"></div>
      <div class="avatar-option" style="background-image: url('img/avatars/avatar_spacekid.png');" onclick="selectAvatar(this, 'img/avatars/avatar_spacekid.png', 'ğŸŒˆ ç´”çœŸçš„å¿ƒéˆï¼Œå‰µé€ å¥‡è¹Ÿçš„åŠ›é‡ï¼', {rate: 1.0, pitch: 1.3, volume: 0.85, characterType: 'magician'})"></div>
      <div class="avatar-option" style="background-image: url('img/avatars/avatar_astro1.png');" onclick="selectAvatar(this, 'img/avatars/avatar_astro1.png', 'ğŸš€ æ¢ç´¢æœªçŸ¥çš„å®‡å®™ï¼Œç™¼ç¾ç„¡é™å¯èƒ½ï¼', {rate: 0.85, pitch: 1.05, volume: 0.9, characterType: 'explorer'})"></div>
      <div class="avatar-option" style="background-image: url('https://shop.nijisanji.jp/on/demandware.static/-/Sites-shop-nijisanji-niji-Library/default/dwc53819fc/lp/AGF2024/img/top/t_v_03.png');" onclick="selectAvatar(this, 'https://shop.nijisanji.jp/on/demandware.static/-/Sites-shop-nijisanji-niji-Library/default/dwc53819fc/lp/AGF2024/img/top/t_v_03.png', 'ğŸ­ ç¥ç§˜çš„è™›æ“¬å¶åƒï¼Œå¸¶ä¾†ç„¡é™é­…åŠ›ï¼', {rate: 0.9, pitch: 1.1, volume: 0.9, characterType: 'idol'})"></div>
      <div class="avatar-option" style="background-image: url('img/avatars/vDS8zQP9HdvxX0g (1).png');" onclick="selectAvatar(this, 'img/avatars/vDS8zQP9HdvxX0g (1).png', 'ğŸŒ¸ æº«æŸ”çš„æ«»èŠ±ç²¾éˆï¼Œæ•£æ’­ç¾å¥½èˆ‡å¸Œæœ›ï¼', {rate: 0.85, pitch: 1.05, volume: 0.9, characterType: 'fairy'})"></div>
    </div>

    <!-- ä¸»æŒ‰éˆ•å€åŸŸ -->
    <div class="main-buttons">
      <button class="btn" onclick="location.href='atlas.html'">ğŸš€ é–‹å§‹å†’éšª</button>
      <button class="btn" onclick="location.href='book.html'">ğŸ“š å–®å­—æœ¬</button>
      <button class="btn" onclick="location.href='grammar_tower_select.html'">ğŸ›ï¸ æ–‡æ³•å¡”</button>
      <button class="btn" onclick="location.href='shop.html'">ğŸ›’ å•†åŸ</button>
      <button class="btn" onclick="location.href='gacha.html'">ğŸ² æŠ½å¡</button>
    </div>

    <div class="nav-buttons">
      <button class="nav-btn" id="cardsBtn" onclick="location.href='cards.html'">ğŸ“ å¡ç‰‡æ”¶è—</button>
      <button class="nav-btn" id="achievementBtn" onclick="location.href='achievement.html'">ğŸ† æˆå°±å‹³ç« </button>
    </div>
  </div>

  <!-- éŸ³æ•ˆæ§åˆ¶ -->
  <div id="audioControls">
    <button id="toggleMusic" title="èƒŒæ™¯éŸ³æ¨‚">
      <span class="material-icons">music_note</span>
    </button>
  </div>

  <!-- éŸ³æ•ˆå…ƒç´  -->
  <audio id="typingSound" preload="auto">
    <source src="sound/type.mp3" type="audio/mpeg">
  </audio>

  <audio id="backgroundMusic" loop>
    <source src="sound/åˆå¾Œæ”¾é¬†æ™‚å…‰ï¼ˆç´”éŸ³æ¨‚ï¼‰.mp3" type="audio/mpeg">
  </audio>

  <script src="js/userData.js"></script>
  <script src="js/achievementSystem.js"></script>
  <script src="js/characterDialogue.js"></script>
  <script src="cards.js"></script>
  <script>
    console.log('=== JavaScripté–‹å§‹åŸ·è¡Œ ===');
    
    // æˆå°±ç³»çµ±æ•¸æ“šï¼ˆèˆ‡achievement.htmlä¿æŒä¸€è‡´ï¼‰
    const achievements = [
      { id: 'bronze', name: 'éŠ…ç‰Œæ”¶é›†è€…', requirement: 10, reward: 5, icon: 'ğŸ¥‰', type: 'collection', description: 'æ”¶é›†10å¼µå¡ç‰‡ï¼Œé–‹å§‹ä½ çš„æ”¶é›†ä¹‹æ—…' },
      { id: 'silver', name: 'éŠ€ç‰Œæ”¶é›†è€…', requirement: 25, reward: 15, icon: 'ğŸ¥ˆ', type: 'collection', description: 'æ”¶é›†25å¼µå¡ç‰‡ï¼Œå±•ç¾ä½ çš„æ”¶é›†å¯¦åŠ›' },
      { id: 'gold', name: 'é‡‘ç‰Œæ”¶é›†è€…', requirement: 50, reward: 30, icon: 'ğŸ¥‡', type: 'collection', description: 'æ”¶é›†50å¼µå¡ç‰‡ï¼Œæˆç‚ºçœŸæ­£çš„æ”¶é›†è€…' },
      { id: 'platinum', name: 'ç™½é‡‘æ”¶é›†è€…', requirement: 100, reward: 60, icon: 'ğŸ’', type: 'collection', description: 'æ”¶é›†100å¼µå¡ç‰‡ï¼Œé”åˆ°ç™½é‡‘ç­‰ç´š' },
      { id: 'diamond', name: 'é‘½çŸ³æ”¶é›†è€…', requirement: 200, reward: 120, icon: 'ğŸ’ ', type: 'collection', description: 'æ”¶é›†200å¼µå¡ç‰‡ï¼Œç²å¾—é‘½çŸ³æ¦®è€€' },
      { id: 'master', name: 'æ”¶é›†å¤§å¸«', requirement: 500, reward: 300, icon: 'ğŸ‘‘', type: 'collection', description: 'æ”¶é›†500å¼µå¡ç‰‡ï¼Œæˆç‚ºæ”¶é›†å¤§å¸«' },
      { id: 'common_master', name: 'æ™®é€šå¡å¤§å¸«', requirement: 50, reward: 20, icon: 'ğŸ“š', type: 'rarity', rarity: 'æ™®é€š', description: 'æ”¶é›†50å¼µæ™®é€šå¡ç‰‡ï¼ŒæŒæ¡åŸºç¤è©å½™' },
      { id: 'rare_master', name: 'ç¨€æœ‰å¡å¤§å¸«', requirement: 30, reward: 40, icon: 'ğŸ”®', type: 'rarity', rarity: 'ç¨€æœ‰', description: 'æ”¶é›†30å¼µç¨€æœ‰å¡ç‰‡ï¼Œæ“´å±•è©å½™ç¯„åœ' },
      { id: 'epic_master', name: 'è¶…ç¨€æœ‰å¤§å¸«', requirement: 20, reward: 80, icon: 'ğŸŒŸ', type: 'rarity', rarity: 'è¶…ç¨€æœ‰', description: 'æ”¶é›†20å¼µè¶…ç¨€æœ‰å¡ç‰‡ï¼ŒæŒæ¡é«˜ç´šè©å½™' },
      { id: 'shard_collector', name: 'ç¢ç‰‡æ”¶é›†è€…', requirement: 100, reward: 25, icon: 'ğŸ’', type: 'shards', description: 'æ”¶é›†100å€‹ç¢ç‰‡ï¼Œé–‹å§‹ç¢ç‰‡æ”¶é›†ä¹‹è·¯' },
      { id: 'shard_hoarder', name: 'ç¢ç‰‡å›¤ç©è€…', requirement: 500, reward: 100, icon: 'ğŸ¦', type: 'shards', description: 'æ”¶é›†500å€‹ç¢ç‰‡ï¼Œæˆç‚ºç¢ç‰‡å›¤ç©è€…' },
      { id: 'shard_master', name: 'ç¢ç‰‡å¤§å¸«', requirement: 1000, reward: 200, icon: 'ğŸ’', type: 'shards', description: 'æ”¶é›†1000å€‹ç¢ç‰‡ï¼Œæˆç‚ºç¢ç‰‡å¤§å¸«' },
      { id: 'first_card', name: 'åˆå­¸è€…', requirement: 1, reward: 1, icon: 'ğŸ¯', type: 'special', description: 'ç²å¾—ç¬¬ä¸€å¼µå¡ç‰‡ï¼Œé–‹å§‹å­¸ç¿’ä¹‹æ—…' },
      { id: 'lucky_starter', name: 'å¹¸é‹æ–°æ‰‹', requirement: 5, reward: 5, icon: 'ğŸ€', type: 'special', description: 'ç²å¾—5å¼µå¡ç‰‡ï¼Œå±•ç¾ä½ çš„å¹¸é‹' },
      { id: 'dedicated', name: 'å°ˆæ³¨å­¸ç¿’è€…', requirement: 25, reward: 20, icon: 'ï¿½ï¿½', type: 'special', description: 'ç²å¾—25å¼µå¡ç‰‡ï¼Œå±•ç¾ä½ çš„å°ˆæ³¨' },
      { id: 'persistent', name: 'å …æŒä¸æ‡ˆ', requirement: 75, reward: 60, icon: 'ğŸ’ª', type: 'special', description: 'ç²å¾—75å¼µå¡ç‰‡ï¼Œå±•ç¾ä½ çš„å …æŒ' },
      { id: 'vocabulary_king', name: 'è©å½™ä¹‹ç‹', requirement: 150, reward: 150, icon: 'ğŸ‘‘', type: 'special', description: 'ç²å¾—150å¼µå¡ç‰‡ï¼Œæˆç‚ºè©å½™ä¹‹ç‹' },
      { id: 'language_legend', name: 'èªè¨€å‚³å¥‡', requirement: 300, reward: 300, icon: 'ğŸ†', type: 'special', description: 'ç²å¾—300å¼µå¡ç‰‡ï¼Œæˆç‚ºèªè¨€å‚³å¥‡' },
      { id: 'daily_1', name: 'æ¯æ—¥ç°½åˆ°1å¤©', requirement: 1, reward: 2, icon: 'ğŸ“…', type: 'daily', description: 'é€£çºŒç°½åˆ°1å¤©ï¼Œé¤Šæˆå¥½ç¿’æ…£' },
      { id: 'daily_7', name: 'æ¯æ—¥ç°½åˆ°7å¤©', requirement: 7, reward: 10, icon: 'ğŸ“†', type: 'daily', description: 'é€£çºŒç°½åˆ°7å¤©ï¼Œå …æŒä¸€é€±' },
      { id: 'daily_30', name: 'æ¯æ—¥ç°½åˆ°30å¤©', requirement: 30, reward: 50, icon: 'ğŸ—“ï¸', type: 'daily', description: 'é€£çºŒç°½åˆ°30å¤©ï¼Œå …æŒä¸€å€‹æœˆ' },
      { id: 'daily_100', name: 'æ¯æ—¥ç°½åˆ°100å¤©', requirement: 100, reward: 200, icon: 'ğŸ“Š', type: 'daily', description: 'é€£çºŒç°½åˆ°100å¤©ï¼Œæˆç‚ºå¿ å¯¦ç”¨æˆ¶' },
      { id: 'star_collector', name: 'æ˜Ÿæ˜Ÿæ”¶é›†è€…', requirement: 100, reward: 10, icon: 'â­', type: 'stars', description: 'æ”¶é›†100é¡†æ˜Ÿæ˜Ÿï¼Œé–‹å§‹æ˜Ÿæ˜Ÿæ”¶é›†' },
      { id: 'star_hoarder', name: 'æ˜Ÿæ˜Ÿå›¤ç©è€…', requirement: 500, reward: 50, icon: 'âœ¨', type: 'stars', description: 'æ”¶é›†500é¡†æ˜Ÿæ˜Ÿï¼Œæˆç‚ºæ˜Ÿæ˜Ÿå›¤ç©è€…' },
      { id: 'star_master', name: 'æ˜Ÿæ˜Ÿå¤§å¸«', requirement: 1000, reward: 100, icon: 'ğŸŒŸ', type: 'stars', description: 'æ”¶é›†1000é¡†æ˜Ÿæ˜Ÿï¼Œæˆç‚ºæ˜Ÿæ˜Ÿå¤§å¸«' },
      { id: 'star_legend', name: 'æ˜Ÿæ˜Ÿå‚³å¥‡', requirement: 5000, reward: 500, icon: 'ğŸ’«', type: 'stars', description: 'æ”¶é›†5000é¡†æ˜Ÿæ˜Ÿï¼Œæˆç‚ºæ˜Ÿæ˜Ÿå‚³å¥‡' },
      { id: 'speed_learner', name: 'å¿«é€Ÿå­¸ç¿’è€…', requirement: 10, reward: 15, icon: 'âš¡', type: 'performance', description: 'é€šé10å€‹é—œå¡ï¼Œå±•ç¾å¿«é€Ÿå­¸ç¿’èƒ½åŠ›' },
      { id: 'accuracy_master', name: 'æº–ç¢ºå¤§å¸«', requirement: 20, reward: 25, icon: 'ğŸ¯', type: 'performance', description: 'é€šé20å€‹é—œå¡ï¼Œå±•ç¾æº–ç¢ºçš„å­¸ç¿’èƒ½åŠ›' },
      { id: 'combo_king', name: 'é€£æ“Šä¹‹ç‹', requirement: 15, reward: 30, icon: 'ğŸ”¥', type: 'performance', description: 'é€šé15å€‹é—œå¡ï¼Œå±•ç¾é€£æ“Šèƒ½åŠ›' },
      { id: 'fill_beginner', name: 'å¡«ç©ºæ–°æ‰‹', requirement: 1, reward: 5, icon: 'ğŸ“', type: 'fill', description: 'å®Œæˆç¬¬ä¸€æ¬¡å¡«ç©ºæŒ‘æˆ°' },
      { id: 'fill_regular', name: 'å¡«ç©ºå¸¸å®¢', requirement: 10, reward: 20, icon: 'ğŸ“‹', type: 'fill', description: 'å®Œæˆ10æ¬¡å¡«ç©ºæŒ‘æˆ°' },
      { id: 'fill_expert', name: 'å¡«ç©ºå°ˆå®¶', requirement: 50, reward: 80, icon: 'ğŸ“Š', type: 'fill', description: 'å®Œæˆ50æ¬¡å¡«ç©ºæŒ‘æˆ°' },
      { id: 'fill_master', name: 'å¡«ç©ºå¤§å¸«', requirement: 100, reward: 150, icon: 'ğŸ†', type: 'fill', description: 'å®Œæˆ100æ¬¡å¡«ç©ºæŒ‘æˆ°' },
      { id: 'fill_perfect', name: 'å®Œç¾å¡«ç©º', requirement: 1, reward: 30, icon: 'ğŸ’¯', type: 'fill', description: 'åœ¨å¡«ç©ºæŒ‘æˆ°ä¸­ç²å¾—æ»¿åˆ†' },
      { id: 'fill_speed', name: 'å¿«é€Ÿå¡«ç©º', requirement: 5, reward: 25, icon: 'âš¡', type: 'fill', description: 'åœ¨5æ¬¡å¡«ç©ºæŒ‘æˆ°ä¸­å¹³å‡æ™‚é–“å°‘æ–¼15ç§’' },
      { id: 'fill_streak', name: 'é€£çºŒå¡«ç©º', requirement: 7, reward: 40, icon: 'ğŸ”¥', type: 'fill', description: 'é€£çºŒ7å¤©å®Œæˆå¡«ç©ºæŒ‘æˆ°' },
      { id: 'fill_vocab', name: 'è©å½™å¡«ç©º', requirement: 100, reward: 60, icon: 'ğŸ“š', type: 'fill', description: 'åœ¨å¡«ç©ºæŒ‘æˆ°ä¸­ç­”å°100å€‹å–®å­—' },
      { id: 'vocab_beginner', name: 'å–®å­—æ–°æ‰‹', requirement: 10, reward: 15, icon: 'ğŸ“–', type: 'vocabulary', description: 'ç­”å°10å€‹å–®å­—æœ¬çš„å–®å­—ï¼Œé–‹å§‹å–®å­—å­¸ç¿’ä¹‹æ—…' },
      { id: 'vocab_regular', name: 'å–®å­—å¸¸å®¢', requirement: 50, reward: 40, icon: 'ğŸ“š', type: 'vocabulary', description: 'ç­”å°50å€‹å–®å­—æœ¬çš„å–®å­—ï¼Œå±•ç¾å­¸ç¿’ç†±æƒ…' },
      { id: 'vocab_expert', name: 'å–®å­—å°ˆå®¶', requirement: 100, reward: 80, icon: 'ğŸ“', type: 'vocabulary', description: 'ç­”å°100å€‹å–®å­—æœ¬çš„å–®å­—ï¼Œæˆç‚ºå–®å­—å°ˆå®¶' },
      { id: 'vocab_master', name: 'å–®å­—å¤§å¸«', requirement: 200, reward: 150, icon: 'ğŸ‘‘', type: 'vocabulary', description: 'ç­”å°200å€‹å–®å­—æœ¬çš„å–®å­—ï¼Œæˆç‚ºå–®å­—å¤§å¸«' },
      { id: 'vocab_legend', name: 'å–®å­—å‚³å¥‡', requirement: 500, reward: 300, icon: 'ğŸ†', type: 'vocabulary', description: 'ç­”å°500å€‹å–®å­—æœ¬çš„å–®å­—ï¼Œæˆç‚ºå–®å­—å‚³å¥‡' },
      // æ˜Ÿåº§æˆå°±
      { id: 'pass_aries', name: 'é€šéç™½ç¾Šåº§', requirement: 1, reward: 5, icon: 'â™ˆ', type: 'zodiac', description: 'é€šéç™½ç¾Šåº§é—œå¡', rewardRange: [5,5] },
      { id: 'pass_taurus', name: 'é€šéé‡‘ç‰›åº§', requirement: 1, reward: 5, icon: 'â™‰', type: 'zodiac', description: 'é€šéé‡‘ç‰›åº§é—œå¡', rewardRange: [5,5] },
      { id: 'pass_gemini', name: 'é€šéé›™å­åº§', requirement: 1, reward: 5, icon: 'â™Š', type: 'zodiac', description: 'é€šéé›™å­åº§é—œå¡', rewardRange: [5,5] },
      { id: 'pass_cancer', name: 'é€šéå·¨èŸ¹åº§', requirement: 1, reward: 7, icon: 'â™‹', type: 'zodiac', description: 'é€šéå·¨èŸ¹åº§é—œå¡', rewardRange: [7,10] },
      { id: 'pass_leo', name: 'é€šéç…å­åº§', requirement: 1, reward: 8, icon: 'â™Œ', type: 'zodiac', description: 'é€šéç…å­åº§é—œå¡', rewardRange: [8,12] },
      { id: 'pass_virgo', name: 'é€šéè™•å¥³åº§', requirement: 1, reward: 9, icon: 'â™', type: 'zodiac', description: 'é€šéè™•å¥³åº§é—œå¡', rewardRange: [9,13] },
      { id: 'pass_libra', name: 'é€šéå¤©ç§¤åº§', requirement: 1, reward: 10, icon: 'â™', type: 'zodiac', description: 'é€šéå¤©ç§¤åº§é—œå¡', rewardRange: [10,14] },
      { id: 'pass_scorpio', name: 'é€šéå¤©è åº§', requirement: 1, reward: 11, icon: 'â™', type: 'zodiac', description: 'é€šéå¤©è åº§é—œå¡', rewardRange: [11,15] },
      { id: 'pass_sagittarius', name: 'é€šéå°„æ‰‹åº§', requirement: 1, reward: 12, icon: 'â™', type: 'zodiac', description: 'é€šéå°„æ‰‹åº§é—œå¡', rewardRange: [12,16] },
      { id: 'pass_capricorn', name: 'é€šéæ‘©ç¾¯åº§', requirement: 1, reward: 13, icon: 'â™‘', type: 'zodiac', description: 'é€šéæ‘©ç¾¯åº§é—œå¡', rewardRange: [13,17] },
      { id: 'pass_aquarius', name: 'é€šéæ°´ç“¶åº§', requirement: 1, reward: 14, icon: 'â™’', type: 'zodiac', description: 'é€šéæ°´ç“¶åº§é—œå¡', rewardRange: [14,18] },
      { id: 'pass_pisces', name: 'é€šéé›™é­šåº§', requirement: 1, reward: 15, icon: 'â™“', type: 'zodiac', description: 'é€šéé›™é­šåº§é—œå¡', rewardRange: [15,20] },
      { id: 'pass_andromeda', name: 'é€šéä»™å¥³åº§', requirement: 1, reward: 16, icon: 'ğŸ‘¸', type: 'zodiac', description: 'é€šéä»™å¥³åº§é—œå¡', rewardRange: [16,20] },
      { id: 'pass_cygnus', name: 'é€šéå¤©éµåº§', requirement: 1, reward: 17, icon: 'ğŸ¦¢', type: 'zodiac', description: 'é€šéå¤©éµåº§é—œå¡', rewardRange: [17,20] },
      { id: 'pass_orion', name: 'é€šéçµæˆ¶åº§', requirement: 1, reward: 17, icon: 'ğŸ¹', type: 'zodiac', description: 'é€šéçµæˆ¶åº§é—œå¡', rewardRange: [17,20] },
      { id: 'pass_pegasus', name: 'é€šéé£›é¦¬åº§', requirement: 1, reward: 17, icon: 'ğŸ¦„', type: 'zodiac', description: 'é€šéé£›é¦¬åº§é—œå¡', rewardRange: [17,20] },
      { id: 'pass_cassiopeia', name: 'é€šéä»™ååº§', requirement: 1, reward: 17, icon: 'ğŸ‘‘', type: 'zodiac', description: 'é€šéä»™ååº§é—œå¡', rewardRange: [17,20] },
      { id: 'pass_scorpius', name: 'é€šéå¤©è åº§', requirement: 1, reward: 17, icon: 'ğŸ¦‚', type: 'zodiac', description: 'é€šéå¤©è åº§é—œå¡', rewardRange: [17,20] },
      { id: 'pass_phoenix', name: 'é€šéé³³å‡°åº§', requirement: 1, reward: 17, icon: 'ğŸ”¥', type: 'zodiac', description: 'é€šéé³³å‡°åº§é—œå¡', rewardRange: [17,20] },
      { id: 'pass_vela', name: 'é€šéèˆ¹å¸†åº§', requirement: 1, reward: 17, icon: 'â›µ', type: 'zodiac', description: 'é€šéèˆ¹å¸†åº§é—œå¡', rewardRange: [17,20] },
    ];

    // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥æ¯æ—¥ç°½åˆ°çå‹µ
    document.addEventListener('DOMContentLoaded', function() {
      // å»¶é²ä¸€é»æ™‚é–“ç¢ºä¿æ‰€æœ‰ç³»çµ±éƒ½å·²è¼‰å…¥
      setTimeout(() => {
        checkDailyReward();
        // ç¢ºä¿cards.jsè¼‰å…¥å®Œæˆå¾Œå†æª¢æŸ¥æˆå°±
        if (window.allCards) {
          updateAchievementBadge();
        } else {
          // å¦‚æœcards.jsé‚„æ²’è¼‰å…¥ï¼Œå†ç­‰ä¸€ä¸‹
          setTimeout(updateAchievementBadge, 2000);
        }
      }, 1000);
    });

    // ç²å–ä¸¦é¡¯ç¤ºæ˜Ÿæ˜Ÿç¸½æ•¸
    function updateStarsDisplay() {
      LinkageSystem.stars.updateDisplay();
    }

    // é é¢è¼‰å…¥æ™‚æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
    updateStarsDisplay();

    // æˆå°±ç³»çµ±ç›¸é—œå‡½æ•¸
    function getClaimedAchievements() {
      return JSON.parse(localStorage.getItem('claimedAchievements') || '[]');
    }

    function checkAchievementUnlocked(ach) {
      const ownedCards = JSON.parse(localStorage.getItem('ownedCards') || '{}');
      const shards = JSON.parse(localStorage.getItem('cardShards') || '{}');
      
      switch (ach.type) {
        case 'collection':
        case 'special':
          return Object.keys(ownedCards).length >= ach.requirement;
        case 'rarity':
          // æª¢æŸ¥ç¨€æœ‰åº¦å¡ç‰‡æ•¸é‡
          if (window.allCards) {
            const cardsByRarity = window.allCards.filter(card => 
              card.rarity === ach.rarity && ownedCards[card.word]
            );
            return cardsByRarity.length >= ach.requirement;
          }
          return false; // å¦‚æœæ²’æœ‰allCardsæ•¸æ“šï¼Œè¿”å›false
        case 'shards':
          return Object.values(shards).reduce((sum, c) => sum + c, 0) >= ach.requirement;
        case 'daily':
          return parseInt(localStorage.getItem('loginDays') || '0') >= ach.requirement;
        case 'stars':
          return parseInt(localStorage.getItem('totalStars') || '0') >= ach.requirement;
        case 'performance':
          const fillGames = parseInt(localStorage.getItem('fillGamesCompleted') || '0');
          const cardGames = parseInt(localStorage.getItem('cardGamesCompleted') || '0');
          const quizGames = parseInt(localStorage.getItem('quizGamesCompleted') || '0');
          const spellingGames = parseInt(localStorage.getItem('spellingGamesCompleted') || '0');
          const matchingGames = parseInt(localStorage.getItem('matchingGamesCompleted') || '0');
          const timeChallengeGames = parseInt(localStorage.getItem('timeChallengeGamesCompleted') || '0');
          return (fillGames + cardGames + quizGames + spellingGames + matchingGames + timeChallengeGames) >= ach.requirement;
        case 'fill':
          switch (ach.id) {
            case 'fill_beginner':
            case 'fill_regular':
            case 'fill_expert':
            case 'fill_master':
              return parseInt(localStorage.getItem('fillGamesCompleted') || '0') >= ach.requirement;
            case 'fill_perfect':
              return parseInt(localStorage.getItem('fillPerfectScores') || '0') >= ach.requirement;
            case 'fill_speed':
              return parseInt(localStorage.getItem('fillSpeedGames') || '0') >= ach.requirement;
            case 'fill_streak':
              return parseInt(localStorage.getItem('fillStreakDays') || '0') >= ach.requirement;
            case 'fill_vocab':
              return parseInt(localStorage.getItem('fillCorrectWords') || '0') >= ach.requirement;
            default:
              return false;
          }
        case 'vocabulary':
          return parseInt(localStorage.getItem('vocabularyCorrectWords') || '0') >= ach.requirement;
        case 'zodiac':
          // æ˜Ÿåº§é—œå¡æˆå°±ï¼šæª¢æŸ¥è©²æ˜Ÿåº§æ˜¯å¦å·²é€šé
          const zodiacKey = ach.id.replace('pass_', '');
          const passedAtlas = JSON.parse(localStorage.getItem('passed_atlas') || '[]');
          return passedAtlas.includes(zodiacKey);
        default:
          return false;
      }
    }

    // è¨ˆç®—å¯é ˜å–æˆå°±æ•¸é‡
    function getUnclaimedAchievementsCount() {
      const claimed = getClaimedAchievements();
      return achievements.filter(ach => 
        checkAchievementUnlocked(ach) && !claimed.includes(ach.id)
      ).length;
    }

    // æ›´æ–°æˆå°±æŒ‰éˆ•çš„æ³¡æ³¡
    function updateAchievementBadge() {
      const achievementBtn = document.getElementById('achievementBtn');
      if (!achievementBtn) {
        console.log('æ‰¾ä¸åˆ°æˆå°±æŒ‰éˆ•');
        return;
      }

      const unclaimedCount = getUnclaimedAchievementsCount();
      console.log('å¯é ˜å–æˆå°±æ•¸é‡:', unclaimedCount);
      
      // ç§»é™¤ç¾æœ‰çš„æ³¡æ³¡
      const existingBadge = achievementBtn.querySelector('.achievement-badge');
      if (existingBadge) {
        existingBadge.remove();
      }

      // å¦‚æœæœ‰å¯é ˜å–çš„æˆå°±ï¼Œæ·»åŠ æ³¡æ³¡
      if (unclaimedCount > 0) {
        console.log('æ·»åŠ æˆå°±æ³¡æ³¡ï¼Œæ•¸é‡:', unclaimedCount);
        const badge = document.createElement('div');
        badge.className = 'achievement-badge';
        badge.textContent = unclaimedCount;
        achievementBtn.appendChild(badge);
      } else {
        console.log('æ²’æœ‰å¯é ˜å–çš„æˆå°±');
      }
    }

    // å®šæœŸæª¢æŸ¥æˆå°±ç‹€æ…‹ï¼ˆæ¯30ç§’æª¢æŸ¥ä¸€æ¬¡ï¼‰
    setInterval(updateAchievementBadge, 30000);

    // é é¢ç²å¾—ç„¦é»æ™‚ä¹Ÿæª¢æŸ¥ä¸€æ¬¡
    window.addEventListener('focus', updateAchievementBadge);
    
    // æ¸¬è©¦å‡½æ•¸ï¼šæ‰‹å‹•æª¢æŸ¥æˆå°±ç‹€æ…‹
    function testAchievementBadge() {
      console.log('=== æˆå°±æ³¡æ³¡æ¸¬è©¦ ===');
      console.log('allCardsè¼‰å…¥ç‹€æ…‹:', !!window.allCards);
      console.log('ownedCards:', JSON.parse(localStorage.getItem('ownedCards') || '{}'));
      console.log('claimedAchievements:', getClaimedAchievements());
      
      // æ¸¬è©¦å¹¾å€‹æˆå°±çš„ç‹€æ…‹
      const testAchievements = achievements.slice(0, 5);
      testAchievements.forEach(ach => {
        const unlocked = checkAchievementUnlocked(ach);
        console.log(`${ach.name}: ${unlocked ? 'å·²è§£é–' : 'æœªè§£é–'}`);
      });
      
      // æ¸¬è©¦ï¼šæ‰‹å‹•å‰µå»ºä¸€äº›æ¸¬è©¦æ•¸æ“š
      console.log('=== å‰µå»ºæ¸¬è©¦æ•¸æ“š ===');
      const testOwnedCards = { 'test1': true, 'test2': true, 'test3': true };
      localStorage.setItem('ownedCards', JSON.stringify(testOwnedCards));
      console.log('è¨­ç½®æ¸¬è©¦ownedCards:', testOwnedCards);
      
      // é‡æ–°æª¢æŸ¥æˆå°±
      const newUnclaimedCount = getUnclaimedAchievementsCount();
      console.log('æ¸¬è©¦å¾Œå¯é ˜å–æˆå°±æ•¸é‡:', newUnclaimedCount);
      
      updateAchievementBadge();
    }
    
    // é é¢å®Œå…¨è¼‰å…¥å¾Œæ¸¬è©¦
    window.addEventListener('load', function() {
      setTimeout(testAchievementBadge, 3000);
    });

    // é ­åƒé¸æ“‡
    function selectAvatar(element, imagePath, slogan, voiceSettings) {
      // ç§»é™¤å…¶ä»–é ­åƒçš„é¸ä¸­ç‹€æ…‹
      document.querySelectorAll('.avatar-option').forEach(avatar => {
        avatar.classList.remove('selected');
      });
      
      // æ·»åŠ é¸ä¸­ç‹€æ…‹
      element.classList.add('selected');
      
      // æ›´æ–°é ­åƒå’Œè§’è‰²é è¦½
      LinkageSystem.player.setAvatar(imagePath);
      
      // ä¿å­˜é¸æ“‡åˆ°æœ¬åœ°å­˜å„²
      localStorage.setItem('selectedAvatar', imagePath);
      localStorage.setItem('selectedSlogan', slogan);
      localStorage.setItem('selectedVoiceSettings', JSON.stringify(voiceSettings));
      
      // æ›´æ–°è§’è‰²é è¦½åœ–ç‰‡
      document.getElementById('characterImage').src = imagePath;
      
      // æ›´æ–°è§’è‰²æ¨™èªï¼ˆå¸¶å‹•ç•«æ•ˆæœï¼‰
      const sloganElement = document.getElementById('characterSlogan');
      sloganElement.style.opacity = '0';
      sloganElement.style.transform = 'translateY(20px)';
      
      setTimeout(() => {
        sloganElement.textContent = slogan;
        sloganElement.style.opacity = '1';
        sloganElement.style.transform = 'translateY(0)';
        
        // æœ—è®€æ¨™èª
        speakSlogan(slogan, voiceSettings);
        
        // è§¸ç™¼è§’è‰²å°è©±ç³»çµ±
        if (window.CharacterDialogue) {
          // æ›´æ–°ç•¶å‰è§’è‰²è¨­å®š
          window.CharacterDialogue.currentCharacter = voiceSettings.characterType || 'warrior';
          // é¡¯ç¤ºè§’è‰²æ­¡è¿å°è©±
          setTimeout(() => {
            window.CharacterDialogue.showWelcomeDialogue();
          }, 1000);
        }
      }, 200);
    }

    // èªéŸ³æœ—è®€æ¨™èª
    function speakSlogan(slogan, voiceSettings) {
      console.log('é–‹å§‹èªéŸ³æœ—è®€:', slogan, voiceSettings);
      
      if (!('speechSynthesis' in window)) {
        console.error('ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åˆæˆ');
        alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åˆæˆåŠŸèƒ½');
        return;
      }
      
      // åœæ­¢ä¹‹å‰çš„èªéŸ³
      window.speechSynthesis.cancel();
      
      // ç²å–å¯ç”¨çš„èªéŸ³
      let voices = window.speechSynthesis.getVoices();
      console.log('ç•¶å‰å¯ç”¨èªéŸ³æ•¸é‡:', voices.length);
      
      // å¦‚æœèªéŸ³åˆ—è¡¨é‚„æ²’è¼‰å…¥ï¼Œç­‰å¾…è¼‰å…¥
      if (voices.length === 0) {
        console.log('ç­‰å¾…èªéŸ³åˆ—è¡¨è¼‰å…¥...');
        window.speechSynthesis.onvoiceschanged = () => {
          voices = window.speechSynthesis.getVoices();
          console.log('èªéŸ³åˆ—è¡¨è¼‰å…¥å®Œæˆï¼Œå¯ç”¨èªéŸ³:', voices.map(v => `${v.name} (${v.lang})`));
          speakWithVoice(slogan, voices, voiceSettings);
        };
        return;
      }
      
      // é¡¯ç¤ºå¯ç”¨çš„èªéŸ³åˆ—è¡¨ï¼ˆèª¿è©¦ç”¨ï¼‰
      console.log('å¯ç”¨çš„èªéŸ³åˆ—è¡¨:', voices.map(v => `${v.name} (${v.lang})`));
      speakWithVoice(slogan, voices, voiceSettings);
    }

    // ä½¿ç”¨é¸å®šçš„èªéŸ³æ’­æ”¾
    function speakWithVoice(slogan, voices, voiceSettings) {
      console.log('æº–å‚™æ’­æ”¾èªéŸ³ï¼ŒèªéŸ³è¨­å®š:', voiceSettings);
      
      // å‰µå»ºèªéŸ³åˆæˆ
      const utterance = new SpeechSynthesisUtterance();
      
      // ç‚ºä¸åŒè§’è‰²é¸æ“‡ä¸åŒçš„èªéŸ³
      let selectedVoice = null;
      
      // æ ¹æ“šè§’è‰²ç‰¹é»é¸æ“‡ä¸åŒçš„èªéŸ³
      if (voiceSettings.characterType) {
        console.log('å°‹æ‰¾è§’è‰²é¡å‹:', voiceSettings.characterType);
        
        switch (voiceSettings.characterType) {
          case 'warrior':
            // æˆ°å£«ï¼šé¸æ“‡è¼ƒä½æ²‰çš„èªéŸ³
            selectedVoice = voices.find(voice => 
              voice.name.includes('David') || 
              voice.name.includes('James') ||
              voice.name.includes('Mark') ||
              voice.lang.includes('en')
            );
            break;
          case 'speedster':
            // é–ƒé›»æˆ°å£«ï¼šé¸æ“‡å¹´è¼•æ´»åŠ›çš„èªéŸ³
            selectedVoice = voices.find(voice => 
              voice.name.includes('Alex') || 
              voice.name.includes('Tom') ||
              voice.name.includes('Daniel')
            );
            break;
          case 'defender':
            // é˜²ç¦¦æˆ°å£«ï¼šé¸æ“‡ç©©é‡çš„èªéŸ³
            selectedVoice = voices.find(voice => 
              voice.name.includes('Michael') || 
              voice.name.includes('Robert') ||
              voice.name.includes('William')
            );
            break;
          case 'sharpshooter':
            // ç²¾æº–å°„æ‰‹ï¼šé¸æ“‡å†·éœçš„èªéŸ³
            selectedVoice = voices.find(voice => 
              voice.name.includes('Chris') || 
              voice.name.includes('Kevin') ||
              voice.name.includes('Steven')
            );
            break;
          case 'explorer':
            // æ¢éšªå®¶ï¼šé¸æ“‡å¥½å¥‡çš„èªéŸ³
            selectedVoice = voices.find(voice => 
              voice.name.includes('Sarah') || 
              voice.name.includes('Emma') ||
              voice.name.includes('Lisa')
            );
            break;
          case 'magician':
            // é­”æ³•å¸«ï¼šé¸æ“‡æ´»æ½‘çš„èªéŸ³
            selectedVoice = voices.find(voice => 
              voice.name.includes('Anna') || 
              voice.name.includes('Sophie') ||
              voice.name.includes('Mia')
            );
            break;
          case 'idol':
            // è™›æ“¬å¶åƒï¼šé¸æ“‡ç”œç¾å¯æ„›çš„èªéŸ³
            selectedVoice = voices.find(voice => 
              voice.name.includes('Yuki') || 
              voice.name.includes('Hana') ||
              voice.name.includes('Sakura') ||
              voice.name.includes('Miku') ||
              voice.name.includes('Luna')
            );
            break;
          case 'fairy':
            // æ«»èŠ±ç²¾éˆï¼šé¸æ“‡æº«æŸ”ç”œç¾çš„èªéŸ³
            selectedVoice = voices.find(voice => 
              voice.name.includes('Cherry') || 
              voice.name.includes('Blossom') ||
              voice.name.includes('Sakura') ||
              voice.name.includes('Rose') ||
              voice.name.includes('Lily') ||
              voice.name.includes('Daisy')
            );
            break;
        }
      }
      
      // å¦‚æœæ²’æœ‰æ‰¾åˆ°ç‰¹å®šèªéŸ³ï¼Œå˜—è©¦é¸æ“‡ä¸­æ–‡èªéŸ³
      if (!selectedVoice) {
        console.log('æœªæ‰¾åˆ°ç‰¹å®šèªéŸ³ï¼Œå˜—è©¦é¸æ“‡ä¸­æ–‡èªéŸ³');
        const preferredVoices = voices.filter(voice => 
          voice.lang.includes('zh') || 
          voice.lang.includes('cmn') || 
          voice.name.includes('Chinese') ||
          voice.name.includes('Ting-Ting') ||
          voice.name.includes('Sin-Ji') ||
          voice.name.includes('Mei-Jia')
        );
        
        if (preferredVoices.length > 0) {
          selectedVoice = preferredVoices[0];
          console.log('é¸æ“‡ä¸­æ–‡èªéŸ³:', selectedVoice.name);
        } else {
          // å¦‚æœæ²’æœ‰ä¸­æ–‡èªéŸ³ï¼Œé¸æ“‡ç¬¬ä¸€å€‹å¯ç”¨çš„èªéŸ³
          selectedVoice = voices[0];
          console.log('é¸æ“‡ç¬¬ä¸€å€‹å¯ç”¨èªéŸ³:', selectedVoice.name);
        }
      }
      
      if (selectedVoice) {
        utterance.voice = selectedVoice;
        console.log('ä½¿ç”¨èªéŸ³:', selectedVoice.name, 'è§’è‰²é¡å‹:', voiceSettings.characterType);
      }
      
      // å„ªåŒ–çš„èªéŸ³è¨­å®š
      utterance.lang = selectedVoice ? selectedVoice.lang : 'zh-TW';
      utterance.rate = voiceSettings.rate || 0.85;
      utterance.pitch = voiceSettings.pitch || 1.05;
      utterance.volume = voiceSettings.volume || 0.9;
      utterance.text = slogan.replace(/[ğŸŒŸâš¡ğŸ›¡ï¸ğŸ¯ğŸš€ğŸŒˆ]/g, '');
      
      // æ·»åŠ äº‹ä»¶ç›£è½å™¨
      utterance.onstart = () => console.log('èªéŸ³é–‹å§‹æ’­æ”¾');
      utterance.onend = () => console.log('èªéŸ³æ’­æ”¾çµæŸ');
      utterance.onerror = (event) => console.error('èªéŸ³æ’­æ”¾éŒ¯èª¤:', event.error);
      
      // æ’­æ”¾èªéŸ³
      try {
        window.speechSynthesis.speak(utterance);
        console.log('èªéŸ³æ’­æ”¾æŒ‡ä»¤å·²ç™¼é€');
      } catch (error) {
        console.error('èªéŸ³æ’­æ”¾å¤±æ•—:', error);
        alert('èªéŸ³æ’­æ”¾å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨è¨­å®š');
      }
    }

    // éŸ³æ•ˆæ§åˆ¶
    let isSoundEnabled = true;
    const typingSound = document.getElementById('typingSound');

    function toggleAudio() {
      const button = document.querySelector('#audioControls button');
      isSoundEnabled = !isSoundEnabled;
      if (isSoundEnabled) {
        button.textContent = 'ğŸ”Š';
      } else {
        button.textContent = 'ğŸ”‡';
      }
    }

    // æ’­æ”¾æ‰“å­—éŸ³æ•ˆ
    function playTypingSound() {
      if (isSoundEnabled) {
        typingSound.currentTime = 0;
        typingSound.play().catch(error => {
          console.log('éŸ³æ•ˆæ’­æ”¾å¤±æ•—:', error);
        });
      }
    }

    // ä½¿ç”¨è€…åç¨±è™•ç†
    document.getElementById('playerName').addEventListener('input', function(e) {
      const name = e.target.value.trim();
      if (name) {
        LinkageSystem.player.setName(name);
        playTypingSound();
      }
    });

    // é é¢è¼‰å…¥æ™‚è¼‰å…¥å·²å„²å­˜çš„è³‡æ–™
    window.addEventListener('load', function() {
      // è¼‰å…¥ä½¿ç”¨è€…åç¨±å’Œé ­åƒ
      LinkageSystem.player.updateDisplay();
      
      // è¼‰å…¥ä¿å­˜çš„é ­åƒé¸æ“‡ç‹€æ…‹
      const savedAvatar = localStorage.getItem('selectedAvatar');
      const savedSlogan = localStorage.getItem('selectedSlogan');
      const savedVoiceSettings = localStorage.getItem('selectedVoiceSettings');
      
      if (savedAvatar) {
        // æ‰¾åˆ°å°æ‡‰çš„é ­åƒé¸é …ä¸¦é¸ä¸­
        const avatarOptions = document.querySelectorAll('.avatar-option');
        let foundAvatar = false;
        
        avatarOptions.forEach(option => {
          const backgroundImage = option.style.backgroundImage;
          // æå–èƒŒæ™¯åœ–ç‰‡ä¸­çš„æª”æ¡ˆå
          const urlMatch = backgroundImage.match(/url\(['"]?([^'"]+)['"]?\)/);
          if (urlMatch) {
            const imageUrl = urlMatch[1];
            // æ¯”è¼ƒå®Œæ•´çš„URLè·¯å¾‘
            if (imageUrl === savedAvatar || imageUrl.endsWith(savedAvatar.split('/').pop())) {
              // ç§»é™¤å…¶ä»–é ­åƒçš„é¸ä¸­ç‹€æ…‹
              document.querySelectorAll('.avatar-option').forEach(avatar => {
                avatar.classList.remove('selected');
              });
              
              // æ·»åŠ é¸ä¸­ç‹€æ…‹
              option.classList.add('selected');
              foundAvatar = true;
              
              // æ¢å¾©ä¿å­˜çš„æ¨™èª
              if (savedSlogan) {
                document.getElementById('characterSlogan').textContent = savedSlogan;
              }
              
              // æ›´æ–°è§’è‰²é è¦½åœ–ç‰‡
              document.getElementById('characterImage').src = savedAvatar;
              
              // æ¢å¾©ä¿å­˜çš„èªéŸ³è¨­å®š
              if (savedVoiceSettings) {
                try {
                  const voiceSettings = JSON.parse(savedVoiceSettings);
                  // å¯ä»¥é¸æ“‡æ˜¯å¦åœ¨è¼‰å…¥æ™‚æ’­æ”¾èªéŸ³
                  // speakSlogan(savedSlogan, voiceSettings);
                  
                  // æ›´æ–°è§’è‰²å°è©±ç³»çµ±çš„ç•¶å‰è§’è‰²
                  if (window.CharacterDialogue) {
                    window.CharacterDialogue.currentCharacter = voiceSettings.characterType || 'warrior';
                  }
                } catch (e) {
                  console.log('èªéŸ³è¨­å®šæ¢å¾©å¤±æ•—:', e);
                }
              }
            }
          }
        });
        
        // å¦‚æœæ²’æœ‰æ‰¾åˆ°ä¿å­˜çš„é ­åƒï¼Œä½¿ç”¨é è¨­é ­åƒ
        if (!foundAvatar) {
          console.log('æœªæ‰¾åˆ°ä¿å­˜çš„é ­åƒï¼Œä½¿ç”¨é è¨­é ­åƒ');
          // æ¸…é™¤å¯èƒ½æå£çš„ä¿å­˜æ•¸æ“š
          localStorage.removeItem('selectedAvatar');
          localStorage.removeItem('selectedSlogan');
          localStorage.removeItem('selectedVoiceSettings');
        }
      }
      
      // æª¢æŸ¥æ˜¯å¦ç‚ºé¦–æ¬¡è¨ªå•ï¼Œå¦‚æœæ˜¯å‰‡é¡¯ç¤ºè§’è‰²å°è©±
      const hasShownWelcome = localStorage.getItem('hasShownWelcomeDialogue');
      if (!hasShownWelcome && window.CharacterDialogue) {
        setTimeout(() => {
          window.CharacterDialogue.showWelcomeDialogue();
          localStorage.setItem('hasShownWelcomeDialogue', 'true');
        }, 2000);
      }
    });

    // èƒŒæ™¯éŸ³æ¨‚æ§åˆ¶
    const backgroundMusic = document.getElementById('backgroundMusic');
    const toggleMusicBtn = document.getElementById('toggleMusic');
    let isMusicPlaying = LinkageSystem.music.isPlaying();

    // å¾ localStorage è®€å–éŸ³æ¨‚æ’­æ”¾ç‹€æ…‹
    if (isMusicPlaying) {
      backgroundMusic.play();
      toggleMusicBtn.style.background = 'rgba(0, 255, 255, 0.2)';
    }

    toggleMusicBtn.addEventListener('click', () => {
      if (isMusicPlaying) {
        backgroundMusic.pause();
        toggleMusicBtn.style.background = 'rgba(10, 20, 40, 0.85)';
        LinkageSystem.music.setPlaying(false);
      } else {
        backgroundMusic.play();
        toggleMusicBtn.style.background = 'rgba(0, 255, 255, 0.2)';
        LinkageSystem.music.setPlaying(true);
      }
      isMusicPlaying = !isMusicPlaying;
    });
  </script>
</body>
</html>
